# 总体原则

本文档定义后端开发必须遵守的核心原则。

## 技术栈

本项目采用 **Go + 分层架构**。

| 技术         | 版本  | 用途                  |
| ------------ | ----- | --------------------- |
| Go           | 1.21+ | 编程语言              |
| PostgreSQL   | 15+   | 主数据库              |
| NATS / Kafka | -     | 事件系统              |
| Kubernetes   | -     | 运行时（实例运行）    |

## 核心原则

### 1. 禁止自由发挥

所有代码必须符合既定模板和分层职责，不允许"创新"写法。

### 2. 显式优于隐式

所有行为必须是**显式的、可推导的、无隐式副作用的**。

```go
// 正确：显式传递依赖
func NewInstanceManager(repo InstanceRepository) *InstanceManager {
    return &InstanceManager{repo: repo}
}

// 错误：隐式全局状态
var globalRepo InstanceRepository
func NewInstanceManager() *InstanceManager {
    return &InstanceManager{repo: globalRepo}
}
```

### 3. 保守优先

任何不确定写法，优先选择**最保守、最清晰的实现**。

```go
// 正确：明确的错误处理
if err != nil {
    return nil, fmt.Errorf("failed to create instance: %w", err)
}

// 错误：忽略错误
result, _ := repo.Create(ctx, instance)
```

### 4. 单一职责

每个函数、每个模块只做一件事。

### 5. 可测试性

代码必须易于测试，依赖通过接口注入。

## 代码风格

### 命名规范

```go
// 包名：小写单词
package repository

// 接口名：描述行为
type InstanceRepository interface {}

// 结构体名：名词
type InstanceService struct {}

// 方法名：动词开头
func (s *InstanceService) CreateInstance() {}

// 常量：驼峰或全大写
const MaxRetryCount = 3
const DEFAULT_TIMEOUT = 30
```

### 注释规范

```go
// CreateInstance 创建新实例
// 参数 ctx 上下文
// 参数 req 包含实例基本信息
// 返回创建的实例或错误
func (s *InstanceService) Create(ctx context.Context, req CreateInstanceRequest) (*Instance, error) {
    // ...
}
```

## 相关文档

- [项目分层](./02-项目分层.md)
- [错误处理规范](./05-错误处理规范.md)
- [禁止清单](./15-禁止清单.md)